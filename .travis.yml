env:
  global:

language: python
dist: xenial
python:
  - '2.7'
branches:
  only:
    - master
before_install:
  - sudo apt-get -y install graphviz
  - sudo apt-get -y install cpanminus
  - cpanm --local-lib=~/perl5 local::lib && eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)
  - cpanm Module::Build
install:
  - pip install -r model-desc/reqs.txt
  - pushd make-model
  - perl Build.PL
  - yes | ./Build installdeps --cpan_client cpanm
  - ./Build test --verbose
  - ls -lR .
  - ./Build install
script:
  - popd
  - pushd model-desc
  - pytest && cp icdc-model.yml icdc-model-props.yml ../docs/model-desc && model-tool -g ../docs/model-desc/icdc-model.svg ../docs/model-desc/icdc-model.yml ../docs/model-desc/icdc-model-props.yml

deploy:
  provider: pages
  skip_cleanup: true
  github_token:
    secure: "OUdsh8iNhFxuh7laBeAses18cB2O/Bp9PxrJVcI4jm9bFuhp4zE0AEEyabFXq3YyS4cYAHeR+znsiUPLRNZ3sM6h4FLLzogQDOjeUdirstP4XQ00mQ/BVlyPNAOcbj8bcy+bkO+aKSa0Iyb8IRdcTSKjUI2S3dNeW3UctDEpmNClpYsPbH+64inQt07MF0PV/gBxkBB3bHtRKoSHEkqjaooPoaOtpqKz595T+CTO38NQrK5nFBhUQlcoUCxlna+9PJdt/4uq+7RoayRXw9jegepOwyAkdjMg1kTWSZITyespG1d5PqBGUkihrIKDaKMstnYpY01fc6wrbvtGtG4ne0+fGmOM4IGYOR7joSDi2Z+Nzy69bhu69m1KLLcs1VFzpQBxsMzGW+rEqIak3powGSKGTbXXHTyhugiomTU1FRbq4bwurrSokzd2jH8GbQW7WEwnM3iCH1zEP2zosi2CWFaQcENmGTXjQUXQ0F1cP/Gbwr1KzHB+jYOH60mj4gClSNwb2cznRgltsS3LYHbEcGAW9XkB0IURkwtcemi41MGeW1OG0+0fqEmWaP/GrxOPGXB7vTFXvsQin2ng/knO2XKVGyX+aNUfgUUK9L7VUI3or6fSx8YbhOeEhLDsAj4/KdYd5bSDPn8l1elUAmeGYDE7nwaH9Vu5qGrk/ApwbaA="
  keep_history: true
  on:
    branch: master
    